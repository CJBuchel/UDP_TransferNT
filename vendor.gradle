import groovy.json.JsonOutput

Map<String, Object> vendorJson() {
	return [
		fileName: "UDP_TransferNT.json",
		name: "UDP_TransferNT",
		version: project.version,
		uuid: "d7e51e9d-c0f6-4f51-96f1-cf2beab44a24",
		mavenUrls: [
			mavenUrl
		],

		jsonUrl: "${mavenUrl}/${artifactGroupIdURL}/${depsArtifactId}/${project.version}/${depsArtifactId}-${project.version}.json",
		cppDependencies: [
			[
				groupId: project.group,
				artifactId: baseArtifactId,
				version: project.version,
				libName: "UDP_TransferNT",
				headerClassifier: "headers",
				sharedLibrary: true,
				skipInvalidPlatforms: true,
				binaryPlatforms: []
			]
		]
	]
}

Map<String, Object> vendorJsonLatest() {
	return [
		fileName: "UDP_TransferNT-latest.json",
		name: "UDP_TransferNT",
		version: project.version,
		uuid: "d7e51e9d-c0f6-4f51-96f1-cf2beab44a24",
		mavenUrls: [
			mavenUrl
		],

		jsonUrl: "${mavenUrl}/${artifactGroupIdURL}/${depsArtifactId}/latest/${depsArtifactId}-latest.json",
		cppDependencies: [
			[
				groupId: project.group,
				artifactId: baseArtifactId,
				version: project.version,
				libName: "UDP_TransferNT",
				headerClassifier: "headers",
				sharedLibrary: true,
				skipInvalidPlatforms: true,
				binaryPlatforms: []
			]
		]
	]
}

String vendorJsonString() {
	return JsonOutput.prettyPrint(JsonOutput.toJson(vendorJson()))
}

String vendorJsonLatestString() {
	return JsonOutput.prettyPrint(JsonOutput.toJson(vendorJsonLatest()))
}

task generateVendorDepsJson() {
	def outfile = new File(buildDir, "UDP_TransferNT.json")
	def outfileLatest = new File(buildDir, "UDP_TransferNT-latest.json")
	outputs.file(outfile)
	outputs.file(outfileLatest)

	doLast {
		outfile.text = vendorJsonString()
		outfileLatest.text = vendorJsonLatestString()
	}
}

publishing {
	publications {
		vendordeps(MavenPublication) {
			artifactId 'UDP_TransferNT-Deps'
			artifact(generateVendorDepsJson.outputs.files.files[0]) {
				builtBy generateVendorDepsJson
			}
		}

		vendordepsLatest(MavenPublication) {
			artifactId 'UDP_TransferNT-Deps'
			version = "latest"
			artifact(generateVendorDepsJson.outputs.files.files[1]) {
				builtBy generateVendorDepsJson
			}
		}
	}
}